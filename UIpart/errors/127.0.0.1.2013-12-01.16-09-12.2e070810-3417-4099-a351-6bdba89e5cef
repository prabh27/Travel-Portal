(dp1
S'output'
p2
S"<type 'exceptions.ValueError'> invalid literal for int() with base 10: 'undefined'"
p3
sS'layer'
p4
S'/home/ayush/Desktop/web2py/applications/UIpart/controllers/default.py'
p5
sS'code'
p6
S'# -*- coding: utf-8 -*-\n# this file is released under public domain and you can use without limitations\n\n#########################################################################\n## This is a samples controller\n## - index is the default action of any application\n## - user is required for authentication and authorization\n## - download is for downloading files uploaded in the db (does streaming)\n## - call exposes all registered services (none by default)\n#########################################################################\nsession.var=1\ndef index():\n    """\n    example action using the internationalization operator T and flash\n    rendered by views/default/index.html or views/generic.html\n    """\n    response.flash = "Welcome to web2py!"\n    return dict(message=T(\'Hello World\'))\n\ndef user():\n    """\n    exposes:\n    http://..../[app]/default/user/login\n    http://..../[app]/default/user/logout\n    http://..../[app]/default/user/register\n    http://..../[app]/default/user/profile\n    http://..../[app]/default/user/retrieve_password\n    http://..../[app]/default/user/change_password\n    use @auth.requires_login()\n        @auth.requires_membership(\'group name\')\n        @auth.requires_permission(\'read\',\'table name\',record_id)\n    to decorate functions that need access control\n    """\n    return dict(form=auth())\n\n\ndef download():\n    """\n    allows downloading of uploaded files\n    http://..../[app]/default/download/[filename]\n    """\n    return response.download(request,db)\n\n\ndef call():\n    """\n    exposes services. for example:\n    http://..../[app]/default/call/jsonrpc\n    decorate with @services.jsonrpc the functions to expose\n    supports xml, json, xmlrpc, jsonrpc, amfrpc, rss, csv\n    """\n    return service()\n\n\n@auth.requires_signature()\ndef data():\n    """\n    http://..../[app]/default/data/tables\n    http://..../[app]/default/data/create/[table]\n    http://..../[app]/default/data/read/[table]/[id]\n    http://..../[app]/default/data/update/[table]/[id]\n    http://..../[app]/default/data/delete/[table]/[id]\n    http://..../[app]/default/data/select/[table]\n    http://..../[app]/default/data/search/[table]\n    but URLs must be signed, i.e. linked with\n      A(\'table\',_href=URL(\'data/tables\',user_signature=True))\n    or with the signed load operator\n      LOAD(\'default\',\'data.load\',args=\'tables\',ajax=True,user_signature=True)\n    """\n    return dict(form=crud())\n\nimport datetime\ndef index():\n\tform=SQLFORM.factory(\n\t\t\tField(\'From\',requires=IS_IN_DB(db,db.places.body)),\n\t\t\tField(\'To\',requires=IS_IN_DB(db,db.places.body)),\n\t\t\tField(\'d\',\'date\',label=\'Date of journey\',requires=IS_DATE()),\n\t\t\tField(\'Class\',requires=IS_IN_SET([\'Business\',\'Economy\'])),\n\t\t\tField(\'seats\',label=\'Number of passengers\',requires=IS_IN_SET((1,2,3,4,5,6,7,8,9,10))))\n\tif form.accepts(request.vars,session):\n\t\tif form.vars.From == form.vars.To:\n\t\t\tsession.flash="Source and Destination should not be the same!"\n\t\t\tredirect(URL(\'index\'))\n\t\tif form.vars.d<datetime.date.today():\n\t\t\tsession.flash="Enter a valid date!"\n\t\t\tredirect(URL(\'index\'))\n\t\telse:\n\t\t\tredirect(URL(\'search\',args=(request.vars.From,request.vars.To,request.vars.d,request.vars.seats,request.vars.Class)))\n\tsession.var=1\n\treturn dict(form=form)\n\ndef search():\n\tsession.date=request.args(2)\n\tsrc=db((db.trips.src==request.args(0))&(db.trips.d==request.args(2))&(db.trips.cl==str(request.args(4)))).select()\n\tdest=db((db.trips.dest==request.args(1))&(db.trips.cl==str(request.args(4)))).select()\n    \tif len(src)==0 or len(dest)==0:\n       \t \tsession.flash="No Trips Found! :( "\n        \tredirect(URL(\'index\'))\n\tlis=[]\n\tfor i in range(0,len(dest)):\n\t\tque=dest[i].name\n\t\tfor j in range(len(src)):\n\t\t\tif que==src[j].name:\n\t\t\t\tlis.append(que)\n\tif len(lis)==0:\n\t  \tsession.flash="No trips found!"\n\t  \tredirect(URL(\'index\'))\n\tseats=[]\n\tprice=[]\n\tlogo=[]\n\tdtime=[]\n\tatime=[]\n\tn=[]\n\tcompany=[]\n\tfor i in range(len(lis)):\n\t\tsend=[]\n\t\tsome=db((db.trips.name==lis[i])&(db.trips.src==request.args(0))).select()\n\t\tif len(some):\n\t\t\tsend.append(some[0].id)\n\t\t\tdesti=some[0].dest\n\t\t\tm=some[0].seats\n\t\t\tp=some[0].price\n\t\t\tdtime.append(some[0].departure)\n\t\t\twhile desti!=request.args(1):\n\t\t\t\tsome=db((db.trips.name==lis[i])&(db.trips.src==desti)).select()\n\t\t\t\tif len(some):\t\n\t\t\t\t\tdesti=some[0].dest\n\t\t\t\t\tif some[0].seats<m:\n\t\t\t\t\t\tm=some[0].seats\n\t\t\t\t\tp+=some[0].price\n\t\t\t\t\tsend.append(some[0].id)\n\t\t\t\telse:\n\t\t\t\t\tsession.flash="No trips Found!"\n\t\t\t\t\tredirect(URL(\'index\'))\n\t\t\tatime.append(some[0].arrival)\n\t\t\tn.append(send)\n\t\t\tlogo.append(some[0].logo)\n\t\t\tcompany.append(some[0].company)\n\t\t\tseats.append(m)\n\t\t\tprice.append(p)\n\t\telse:\n\t\t\tsession.flash="No trips found!"\n\t\t\tredirect(URL(\'index\'))\n\tl=len(lis)\n\tfor i in range(l):\n\t\tif seats[i]<int(request.args(3)):\n\t\t\tseats.remove(seats[i])\n\t\t\tprice.remove(price[i])\n\t\t\tlogo.remove(logo[i])\n\t\t\tatime.remove(atime[i])\n\t\t\tdtime.remove(dtime[i])\n\t\t\tlis.remove(lis[i])\n\tnew=[]\n\tfor i in n:\n\t\tst=""\n\t\tfor j in i:\n\t\t\tst+=str(j)\n\t\t\tst+=\'_\'\n\t\tnew.append(st[0:-1])\n\treturn dict(lis=lis,seats=seats,new=new,price=price,dtime=dtime,atime=atime,logo=logo,company=company)\n\nimport time\n@auth.requires_login()\ndef confirm():\n\tprint session.date\n\treturn dict()\t\n\n\nfrom gluon.tools import Mail\nmail = Mail()\nmail.settings.server = \'smtp.gmail.com:587\'\nmail.settings.sender = \'Traveller\\\'s paradise\'\nmail.settings.login = \'ayushkhandelwal115@gmail.com:ayush115\'\ndef book():\n\tn=request.vars.send\n\tn=request.vars.send.split(\'_\')\n\tred=db((db.trips.name==request.vars.lis)&(db.trips.cl==request.vars.cl)).select()\n\tfor i in range(len(n)):\n\t\tseats=db(db.trips.id==n[i]).select()\n\t\tseat=seats[0].seats\n\t\tdb(db.trips.id==n[i]).update(seats=seat-int(request.vars.seats))\n\tdb.flight_bookings.insert(user_id=auth.user.id,num=request.vars.seats,d=session.date,arrival=request.vars.atime,depart=request.vars.dtime,lis=request.vars.send,price=request.vars.price,booked_in=request.vars.lis,src=request.vars.src,dest=request.vars.dest,cl=request.vars.cl)\n\temail=auth.user.email\n\tmail.send(to=[email],\n\t\t\tsubject=\'Ticket booked!\',\n\t\t\tmessage=\'Flight id :\'+request.vars.lis+\'\\nDeparture time : \'+request.vars.dtime+\'\\nArrival time : \'+request.vars.atime+\'\\nNumber of seats : \'+request.vars.seats+\'\\n\')\n\tsession.flash="Your ticket has been booked!"\n\tredirect(URL(\'index\'))\n\ndef bus_booking():\n\tsession.var=3\t\n\tform=SQLFORM.factory(\n\t\t\tField(\'From\',requires=IS_IN_DB(db,db.places.body)),\n\t\t\tField(\'To\',requires=IS_IN_DB(db,db.places.body)),\n\t\t\tField(\'d\',\'date\',label=\'Date of journey\',requires=IS_DATE()),\n\t\t\tField(\'seats\',label=\'Number of passengers\',requires=IS_IN_SET((1,2,3,4,5,6,7,8,9,10))))\n\tif form.accepts(request.vars,session):\n\t\tif form.vars.From == form.vars.To:\n\t\t\tsession.flash="Source and Destination should not be the same!"\n\t\t\tredirect(URL(\'bus_booking\'))\n\t\tif form.vars.d<datetime.date.today():\n\t\t\tsession.flash="Enter a valid date!"\n\t\t\tredirect(URL(\'bus_booking\'))\n\t\telse:\n\t\t\tredirect(URL(\'bus_result\',args=(request.vars.From,request.vars.To,request.vars.d,request.vars.seats)))  \n\treturn dict(form=form)\n\ndef bus_result():\n\tsession.date=request.args(2)\n\tsrc=db((db.bus_trips.src==request.args(0))&(db.bus_trips.d==request.args(2))&(db.bus_trips.seats>int(request.args(3)))).select()\n\tdest=db((db.bus_trips.dest==request.args(1))&(db.bus_trips.seats>int(request.args(3)))).select()\n    \tif len(src)==0 or len(dest)==0:\n       \t \tsession.flash="No Trips Found! :( "\n        \tredirect(URL(\'bus_booking\'))\n\tlis=[]\n\tfor i in range(0,len(dest)):\n\t\tque=dest[i].name\n\t\tfor j in range(len(src)):\n\t\t\tif que==src[j].name:\n\t\t\t\tlis.append(que)\n\tif len(lis)==0:\n\t  \tsession.flash="No trips found!"\n\t  \tredirect(URL(\'bus_booking\'))\n\tseats=[]\n\tprice=[]\n\tlogo=[]\n\tdtime=[]\n\tatime=[]\n\tn=[]\n\tcompany=[]\n\tfor i in range(len(lis)):\n\t\tsend=[]\n\t\tsome=db((db.bus_trips.name==lis[i])&(db.bus_trips.src==request.args(0))).select()\n\t\tif len(some):\n\t\t\tsend.append(some[0].id)\n\t\t\tdesti=some[0].dest\n\t\t\tm=some[0].seats\n\t\t\tp=some[0].price\n\t\t\tdtime.append(some[0].departure)\n\t\t\twhile desti!=request.args(1):\n\t\t\t\tsome=db((db.bus_trips.name==lis[i])&(db.bus_trips.src==desti)).select()\n\t\t\t\tif len(some):\t\n\t\t\t\t\tdesti=some[0].dest\n\t\t\t\t\tif some[0].seats<m:\n\t\t\t\t\t\tm=some[0].seats\n\t\t\t\t\tp+=some[0].price\n\t\t\t\t\tsend.append(some[0].id)\n\t\t\t\telse:\n\t\t\t\t\tsession.flash="No trips Found!"\n\t\t\t\t\tredirect(URL(\'index\'))\n\t\t\tatime.append(some[0].arrival)\n\t\t\tn.append(send)\n\t\t\tlogo.append(some[0].logo)\n\t\t\tcompany.append(some[0].company)\n\t\t\tseats.append(m)\n\t\t\tprice.append(p)\n\t\telse:\n\t\t\tsession.flash="No trips found!"\n\t\t\tredirect(URL(\'bus_booking\'))\n\tnew=[]\n\tfor i in n:\n\t\tst=""\n\t\tfor j in i:\n\t\t\tst+=str(j)\n\t\t\tst+=\'_\'\n\t\tnew.append(st[0:-1])\n\treturn dict(lis=lis,seats=seats,new=new,price=price,dtime=dtime,atime=atime,logo=logo,company=company)\n\ndef bus_confirm():\n\tprint session.date\n\treturn dict()\t\n\n\nfrom gluon.tools import Mail\nmail = Mail()\nmail.settings.server = \'smtp.gmail.com:587\'\nmail.settings.sender = \'Traveller\\\'s paradise\'\nmail.settings.login = \'ayushkhandelwal115@gmail.com:ayush115\'\ndef bus_book():\n\tn=request.vars.send\n\tn=request.vars.send.split(\'_\')\n\tred=db(db.bus_trips.name==request.vars.lis).select()\n\tfor i in range(len(n)):\n\t\tseats=db(db.bus_trips.id==n[i]).select()\n\t\tseat=seats[0].seats\n\t\tdb(db.bus_trips.id==n[i]).update(seats=seat-int(request.vars.seats))\n\tdb.bus_bookings.insert(user_id=auth.user.id,num=request.vars.seats,d=session.date,arrival=request.vars.atime,depart=request.vars.dtime,lis=request.vars.send,price=request.vars.price,booked_in=request.vars.lis,src=request.vars.src,dest=request.vars.dest)\n\temail=auth.user.email\n\tmail.send(to=[email],\n\t\t\tsubject=\'Ticket booked!\',\n\t\t\tmessage=\'Bus id :\'+request.vars.lis+\'\\nDeparture time : \'+request.vars.dtime+\'\\nArrival time : \'+request.vars.atime+\'\\nNumber of seats : \'+request.vars.seats+\'\\n\')\n\tsession.flash="Your ticket has been booked!"\n\tredirect(URL(\'index\'))\n\n@auth.requires_login()\t\ndef manage():\n\tif (auth.user.Member_Type!=\'admin\'):\n\t\tredirect (URL(\'index\'))\n\t\tsession.flash(\'Only the site adin can access this page!\')\n\tform=SQLFORM(db.trips)\n\tif form.accepts(request.vars,session):\n\t\tsession.flash="something"\n\t\tredirect(URL(\'manage\'))\n\tform2=SQLFORM(db.hotels)\n\tif (form.accepts(request.vars,session)):\n\t\tsession.flash="Hotel added!!Good Work"\n\t\tredirect(URL(\'manage\'))\n\tform3=SQLFORM(db.places)\n\tif (form.accepts(request.vars,session)):\n\t\tsession.flash="New Place added in the database!(y)"\n\t\tredirect(URL(\'manage\'))\n\treturn dict(form=form,form2=form2,form3=form3)\n\nimport urllib\nimport json\nfrom pprint import pprint\nimport datetime\ndef hotel_search():\n\tsession.var=4\n\tform=SQLFORM.factory(\n\t\tField(\'city\',requires=IS_IN_DB(db,db.places.body)),\n\t\tField(\'arrivalDate\',\'date\'),\n\t\tField(\'departDate\',\'date\'),\n\t\tField(\'rooms\',\'integer\',requires=IS_IN_SET((1,2,3,4,5))))\n\tif form.accepts(request.vars,session):\n\t\tarrivalDate=form.vars.arrivalDate\n\t\tdepartDate=form.vars.departDate\n#\t\tarrivalDate=str(form.vars.arrivalDate.strftime("%m/%d/%Y"))\n#\t\tdepartDate=str(form.vars.departDate.strftime("%m/%d/%Y"))\n\t\tredirect(URL(r=request,f=\'hotel\',args=(form.vars.city,form.vars.arrivalDate,form.vars.departDate,form.vars.rooms)))\n\treturn dict(form=form)\n\n\nimport re\n\nTAG_RE = re.compile(r\'<[^>]+>\')\n\ndef remove_tags(text):\n\treturn TAG_RE.sub(\'\', text)\n\n\ndef hotel_desc():\n\tsession.var=4\n\tarrivalDate=request.args(1).split(\'-\')\n\tdepartDate=request.args(2).split(\'-\')\n\tadate=arrivalDate[1]+\'/\'+arrivalDate[2]+\'/\'+arrivalDate[0] \n\tddate=departDate[1]+\'/\'+departDate[2]+\'/\'+departDate[0] \n\trooms=""\n\tfor i in range(0,int(request.args(3))):\n\t\trooms+="&room"+str(i+1)+"=2"\n\tlink="http://api.ean.com/ean-services/rs/hotel/v3/avail?&cid=55505&apiKey=nmtccjsdemu6hkg73wcct44t&locale=en_US&currencyCode=INR&hotelId="+request.args(0)+"&arrivalDate="+adate+"&departureDate="+ddate+"&includeDetails=true&includeRoomImages=true"+rooms\n\tlink2="http://api.ean.com/ean-services/rs/hotel/v3/info?cid=55505&apiKey=nmtccjsdemu6hkg73wcct44t&locale=en_US&currencyCode=INR&xml=<HotelInformationRequest><hotelId>"+request.args(0)+"</hotelId><options>0</options></HotelInformationRequest>"\n\ta=urllib.urlopen(link)\n\tdata=json.loads(a.read())\n\ta=urllib.urlopen(link2)\n\tdata2=json.loads(a.read())\n\thotel=data[\'HotelRoomAvailabilityResponse\']\n\tli=data[\'HotelRoomAvailabilityResponse\'][\'HotelRoomResponse\']\n\tdesc=data2[\'HotelInformationResponse\'][\'HotelDetails\'][\'propertyDescription\']\n\trooms=data2[\'HotelInformationResponse\'][\'RoomTypes\']\n\treturn dict(li=li,hotel=hotel,rooms=rooms,desc=desc)\t\n\n@auth.requires_login()\ndef profile():\n\trec=db(auth.user.id==db.auth_user.id).select()\n\tform=crud.update(db.auth_user,auth.user.id)\n\tcrud.settings.update_deletable = False\n\tif (form.process().accepted):\n\t\tredirect(URL(\'profile\'))\n\treturn locals()\n\n@auth.requires_login()\ndef viewbookings():\n        rec=db(db.auth_user.id==auth.user.id).select(db.hotels.ALL,orderby=db.hotels.checkin)\n        flight=db(db.auth_user.id==auth.user.id).select(db.flight_bookings.ALL,orderby=db.flight_bookings.d)\n        return locals()\n\ndef hotel():\n\tsession.var=4\n\trooms=""\n\tadate=""\n\tddate=""\n\tfor i in range(0,int(request.args(3))):\n\t\trooms+="&room"+str(i+1)+"=2"\n\tarrivalDate=request.args(1).split(\'-\')\n\tdepartDate=request.args(2).split(\'-\')\n\tadate=arrivalDate[1]+\'/\'+arrivalDate[2]+\'/\'+arrivalDate[0] \n\tddate=departDate[1]+\'/\'+departDate[2]+\'/\'+departDate[0] \n\tlink="http://api.ean.com/ean-services/rs/hotel/v3/list?cid=55505&apiKey=nmtccjsdemu6hkg73wcct44t&locale=en_US&currencyCode=INR&city="+request.args(0)+"&countryCode=IN&supplierCacheTolerance=MED&arrivalDate="+adate+"&departureDate="+ddate+rooms+"&numberOfResults=10&supplierCacheTolerance=MED_ENHANCED"\n\ta=urllib.urlopen(link)\n\tdata=json.loads(a.read())\n\tli=data["HotelListResponse"]["HotelList"]["HotelSummary"]\n\treturn dict(li=li,rooms=rooms)\n\ndef hotel_confirm():\n\tsession.var=4\n\tarrivalDate=request.args(1).split(\'-\')\n\tdepartDate=request.args(2).split(\'-\')\n\tadate=arrivalDate[1]+\'/\'+arrivalDate[2]+\'/\'+arrivalDate[0] \n\tddate=departDate[1]+\'/\'+departDate[2]+\'/\'+departDate[0] \n\trooms=""\n\tfor i in range(0,int(request.args(3))):\n\t\trooms+="&room"+str(i+1)+"=2"\n\tlink="http://api.ean.com/ean-services/rs/hotel/v3/avail?&cid=55505&apiKey=nmtccjsdemu6hkg73wcct44t&locale=en_US&currencyCode=INR&hotelId="+request.args(0)+"&arrivalDate="+adate+"&departureDate="+ddate+"&includeDetails=true&includeRoomImages=true"+rooms\n\ta=urllib.urlopen(link)\n\tdata=json.loads(a.read())\n\thotel=data[\'HotelRoomAvailabilityResponse\']\n\tli=hotel[\'HotelRoomResponse\']\n\tfin=[]\n\tfor i in range(len(li)):\n\t\tif str(li[i][\'roomTypeCode\'])==str(request.args(4)):\n\t\t\tfin=li[i]\n\t\t\tbreak\n\treturn dict(hotel=hotel,fin=fin)\n\n@auth.requires_login()\ndef booking_done():\n\tsession.var=4\n\tdb.hotels.insert(user_id=str(auth.user.id),checkin=request.args(1),checkout=request.args(2),hotel_code=request.args(0),room_code=request.args(4),rooms=request.args(3))\n\tredirect(URL(\'index\'))\n\treturn dict()\n\ndef add_flight():\n\tcities=db(db.places.id>0).select(db.places.body)\n\treturn dict(cities=cities)\n\ndef add_new():\n\ta=type("")\n\tsrc=request.vars.src\n\tdest=request.vars.dest\n\tprice=request.vars.price\n\tatime=request.vars.arrival\n\tdtime=request.vars.depart\n\tday=request.vars.day\n\ttmp=[]\n\tif type(src)==a:\n\t\tprint \'yes\'\n\t\ttmp.append(src)\n\t\tsrc=tmp\n\t\ttmp=[]\n\t\ttmp.append(dest)\n\t\tdest=tmp\n\t\ttmp=[]\n\t\ttmp.append(price)\n\t\tprice=tmp\n\t\ttmp=[]\n\t\ttmp.append(atime)\n\t\tatime=tmp\n\t\ttmp=[]\n\t\ttmp.append(dtime)\n\t\tdtime=tmp\n\t\ttmp=[]\n\t\ttmp.append(day)\n\t\tday=tmp\n\tprint src\n\tprint dest\n\tprint atime\n\tprint dtime\n\tseatseconomy=int(request.vars.seatseconomy)\n\tseatsbusiness=int(request.vars.seatsbusiness)\n\tdate=datetime.datetime.strptime(request.vars.d,"%Y-%m-%d")\n\tday_len=len(day)\n\tto=datetime.date.today()\n\tdelta=datetime.timedelta(days=1)\n\twhile(day_len):\n\t\tif to.weekday() in day:\n\t\t\tadd_date.append(to)\n\t\tto+=delta\n\t\tday_len-=1\n\tadd_date=[]\n\tif seatseconomy:\n\t  \ttmp=add_date\n\t  \tfor k in range(52):\n\t  \t\tfor j in tmp:\n\t\t\t\tfor i in range(len(src)):\n\t\t\t\t\tdb.trips.insert(src=src[i],dest=dest[i],d=date,price=price[i],departure=dtime[i],arrival=atime[i],cl=\'Economy\',seats=seatseconomy,company=request.vars.company,name=request.vars.name)\n\t\t\tfor j in tmp:\n\t\t\t\ttmp[j]+=datetime.timedelta(days=7)\n\tif seatsbusiness:\n\t\tfor k in range(52):\n\t\t\ttmp=add_date\n\t\t\tfor j in tmp:\n\t\t\t\tfor i in range(len(src)):\n\t\t\t\t\tdb.trips.insert(src=src[i],dest=dest[i],d=date,price=price[i],departure=dtime[i],arrival=atime[i],cl=\'Business\',seats=seatsbusiness,company=request.vars.company,name=request.vars.name)\n\t\t\tfor j in tmp:\n\t\t\t\ttmp[j]+=datetime.timedelta(days=7)\n\treturn dict()\n\nresponse._vars=response._caller(hotel)\n'
p7
sS'snapshot'
p8
(dp9
sS'traceback'
p10
S'Traceback (most recent call last):\n  File "/home/ayush/Desktop/web2py/gluon/restricted.py", line 217, in restricted\n    exec ccode in environment\n  File "/home/ayush/Desktop/web2py/applications/UIpart/controllers/default.py", line 489, in <module>\n  File "/home/ayush/Desktop/web2py/gluon/globals.py", line 372, in <lambda>\n    self._caller = lambda f: f()\n  File "/home/ayush/Desktop/web2py/applications/UIpart/controllers/default.py", line 383, in hotel\n    for i in range(0,int(request.args(3))):\nValueError: invalid literal for int() with base 10: \'undefined\'\n'
p11
s.